---
interface Props {
  src: string;
  alt: string;
  class?: string;
  loading?: "lazy" | "eager";
  widths?: number[];
  sizes?: string;
  fetchpriority?: "high" | "low" | "auto";
}

const {
  src,
  alt,
  class: className = "",
  loading = "lazy",
  widths = [400, 600, 800, 1024, 1280],
  sizes = "100vw",
  fetchpriority = "auto"
} = Astro.props;

// Parse image path to get optimized versions
// Input: /img/hero.jpg -> Output: /img/optimized/hero
const imageName = src.replace('/img/', '').replace(/\.(jpg|jpeg|png|JPG|JPEG|PNG)$/i, '').toLowerCase();
const basePath = `/img/optimized/${imageName}`;
---

<picture>
  <source
    type="image/avif"
    srcset={widths.map(w => `${basePath}-${w}w.avif ${w}w`).join(', ')}
    sizes={sizes}
  />
  <source
    type="image/webp"
    srcset={widths.map(w => `${basePath}-${w}w.webp ${w}w`).join(', ')}
    sizes={sizes}
  />
  <img
    src={`${basePath}.jpg`}
    alt={alt}
    class={className}
    loading={loading}
    decoding="async"
    fetchpriority={fetchpriority}
    width="800"
    height="600"
  />
</picture>

